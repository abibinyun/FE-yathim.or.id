---
import BaseLayout from "../../layouts/BaseLayout.astro";
import ArticleList from "../../components/artikel/ArticleList.tsx";

let allArticles: any[] = [];
try {
  const res = await fetch("https://sys.yathim.or.id/api/articles/all/slug");
  const json = await res.json();
  allArticles = json.data || [];
} catch (err) {
  console.error("Gagal mengambil semua data artikel:", err);
}

let categories = [
  { id: 1, name: "Kegiatan" },
  { id: 2, name: "Berita" },
  { id: 3, name: "Inspirasi" },
  { id: 4, name: "Lainnya" },
];

const PAGE_SIZE = 6;
const totalPages = Math.ceil(allArticles.length / PAGE_SIZE);
const currentPage = 1;
const currentUrl = Astro.url.pathname;

const nextUrl = totalPages > 1 ? `${currentUrl}2` : null;
---

<BaseLayout
  title="Artikel & Berita - Yayasan Taman Harapan Insan Mulia"
  description="Baca berbagai artikel inspiratif, berita kegiatan, dan kisah nyata dari Yayasan Taman Harapan Insan Mulia."
  image="/images/image-yathim.jpeg"
  keywords="artikel, berita, kegiatan, inspirasi, yayasan, yatim, sosial"
  type="website"
>
  <section
    class="bg-gradient-to-br from-primary-600 to-primary-800 text-white py-16"
  >
    <div class="container mx-auto px-4 text-center">
      <h1 class="text-3xl md:text-5xl font-bold mb-6">Artikel & Berita</h1>
      <p class="max-w-3xl mx-auto text-lg md:text-xl text-primary-100">
        Dapatkan informasi terkini dan kisah inspiratif dari berbagai kegiatan kami.
      </p>
    </div>
  </section>

  <ArticleList
    allArticles={allArticles}
    categories={categories}
    currentPage={currentPage}
    totalPages={totalPages}
    nextUrl={nextUrl}
    client:load
  />
</BaseLayout>

---
import BaseLayout from "../../layouts/BaseLayout.astro";
import CampaignList from "../../components/donasi/CampaignList.tsx";
import type { PaginateFunction } from "astro";

export async function getStaticPaths({
  paginate,
}: {
  paginate: PaginateFunction;
}) {
  const res = await fetch(`https://sys.yathim.or.id/api/campaigns/all/slug`);
  const allCampaignsResponse = await res.json();
  const allCampaigns = allCampaignsResponse.data;

  return paginate(allCampaigns, {
    pageSize: 6,
  });
}

const { page } = Astro.props;
const pagination = page;

// Kita perlu data lengkap untuk komponen, jadi kita fetch lagi.
// Ini adalah solusi yang cukup umum untuk pola ini di Astro.
let allCampaignsForComponent: any[] = [];
try {
  const res = await fetch(`https://sys.yathim.or.id/api/campaigns/all/slug`);
  const json = await res.json();
  allCampaignsForComponent = json.data || [];
} catch (err) {
  console.error("Gagal mengambil semua data campaign untuk komponen:", err);
}

let categories = [
  { id: 1, name: "Pendidikan" },
  { id: 2, name: "Kesehatan" },
  { id: 3, name: "Pangan dan Kebutuhan Pokok" },
  { id: 4, name: "Infrastruktur dan Pembangunan" },
  { id: 5, name: "Bencana Alam" },
  { id: 6, name: "Zakat" },
  { id: 7, name: "Wakaf" },
  { id: 9, name: "Sosial" },
  // { id: 10, name: "Penghafal Al-Qur'an dan Pendidikan Agama" },
  // { id: 11, name: "Kemanusiaan" },
  { id: 12, name: "Anak Yatim dan Dhuafa" },
  { id: 13, name: "Sedekah Rutin" }
];

// Perbaiki URL Previous agar menuju ke /donasi, bukan /donasi/1
const prevUrl = pagination.url.prev?.replace("/donasi/1", "/donasi") || null;
const nextUrl = pagination.url.next;
---

<BaseLayout
  title="Program Donasi - Halaman {pagination.currentPage}"
  description="Pilih program donasi yang sesuai dengan keinginan Anda. Setiap donasi akan membuat perbedaan besar bagi mereka yang membutuhkan."
  image="/images/image-yathim.jpeg"
  keywords="donasi, program, bantuan, yayasan, yatim, dhuafa, sosial, amal, zakat, infaq, sedekah"
  type="website"
>
  <section
    class="bg-gradient-to-br from-primary-600 to-primary-800 text-white py-16"
  >
    <div class="container mx-auto px-4 text-center">
      <h1 class="text-3xl md:text-5xl font-bold mb-6">Program Donasi</h1>
      <p class="max-w-3xl mx-auto text-lg md:text-xl text-primary-100">
        Pilih program donasi yang sesuai dengan keinginan Anda. Setiap donasi
        akan membuat perbedaan besar bagi mereka yang membutuhkan.
      </p>
    </div>
  </section>

  <!-- Gunakan komponen React yang sama -->
  <CampaignList
    allCampaigns={allCampaignsForComponent}
    categories={categories}
    currentPage={pagination.currentPage}
    totalPages={pagination.lastPage}
    prevUrl={prevUrl}
    nextUrl={nextUrl}
    client:load
  />
</BaseLayout>

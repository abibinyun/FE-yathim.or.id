---
import BaseLayout from "../../layouts/BaseLayout.astro";
import CampaignList from "../../components/donasi/CampaignList.tsx";

let allCampaigns: any[] = [];
try {
  const res = await fetch("https://sys.yathim.or.id/api/campaigns/all/slug");
  const json = await res.json();
  allCampaigns = json.data || [];
} catch (err) {
  console.error("Gagal mengambil semua data campaign:", err);
}

let categories = [
  { id: 1, name: "Pendidikan" },
  { id: 2, name: "Sosial" },
  { id: 3, name: "Kesehatan" },
  { id: 4, name: "Bencana Alam" },
];

const PAGE_SIZE = 6;
const totalPages = Math.ceil(allCampaigns.length / PAGE_SIZE);
const currentPage = 1;
const currentUrl = Astro.url.pathname;

const nextUrl = totalPages > 1 ? `${currentUrl}2` : null;
---

<BaseLayout
  title="Program Donasi - Yayasan Taman Harapan Insan Mulia"
  description="Pilih program donasi yang sesuai dengan keinginan Anda. Setiap donasi akan membuat perbedaan besar bagi mereka yang membutuhkan."
  image="/images/image-yathim.jpeg"
  keywords="donasi, program, bantuan, yayasan, yatim, dhuafa, sosial, amal, zakat, infaq, sedekah"
  type="website"
>
  <section
    class="bg-gradient-to-br from-primary-600 to-primary-800 text-white py-16"
  >
    <div class="container mx-auto px-4 text-center">
      <h1 class="text-3xl md:text-5xl font-bold mb-6">Program Donasi</h1>
      <p class="max-w-3xl mx-auto text-lg md:text-xl text-primary-100">
        Pilih program donasi yang sesuai dengan keinginan Anda. Setiap donasi
        akan membuat perbedaan besar bagi mereka yang membutuhkan.
      </p>
    </div>
  </section>

  <CampaignList
    allCampaigns={allCampaigns}
    categories={categories}
    currentPage={currentPage}
    nextUrl={nextUrl}
    client:load
  />
</BaseLayout>
